<table class="table">
    <thead>
    <tr>
        <th>ID</th>
        <th>Email</th>
        <th>Name</th>
        <th>Address</th>
        <th>Birthdate</th>
        <th>Role</th>
    </tr>
    </thead>
    <tbody>
    {{range .Users}}
    <tr>
        <td>{{.ID}}</td>
        <td>{{.Email}}</td>
        <td>{{.Username}}</td>
        <td>{{.Address}}</td>
        <td>{{.Birthdate.Format "02/01/2006"}}</td>
        <td>
            <select class="form-control role-select" data-user-id="{{.ID}}">
                <option value="customer" {{if eq .Role "customer"}}selected{{end}}>Customer</option>
                <option value="admin" {{if eq .Role "admin"}}selected{{end}}>Admin</option>
            </select>
        </td>
        <td>
            <button class="btn btn-danger btn-sm delete-user" data-user-id="{{.ID}}">Delete</button>
        </td>
    </tr>
    {{end}}
    </tbody>
</table>

<script>
    $(document).ready(function () {
        // Cập nhật vai trò
        $(".role-select").change(function () {
            let userId = $(this).data("user-id");
            let newRole = $(this).val();

            $.ajax({
                url: "/admin/users/update-role",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({ user_id: userId, role: newRole }),
                success: function (response) {
                    alert("Cập nhật vai trò thành công!");
                    location.reload();
                },
                error: function (err) {
                    alert("Lỗi: " + err.responseJSON.error);
                }
            });
        });

        // Xóa người dùng
        $(".delete-user").click(function () {
            let userId = $(this).data("user-id");
            if (!confirm("Bạn có chắc chắn muốn xóa người dùng này không?")) return;

            $.ajax({
                url: "/admin/users/delete",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ user_id: userId }),
                success: function (response) {
                    alert("Người dùng đã bị xóa!");
                    location.reload();
                },
                error: function (response) {
                    alert("Lỗi: " + response.responseJSON.error);
                }
            });
        });
    });
</script>
